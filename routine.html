<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Academic Timetable</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals with enhanced accents -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Subtle gradient background for a modern feel */
            background: linear-gradient(to bottom right, #fdfdfd, #f0f0f0);
        }
        .tooltip {
            position: absolute;
            background-color: #27272a; /* zinc-800 */
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.875rem;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            white-space: pre-wrap;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); /* Stronger shadow */
            transform: translateY(-10px); /* Slight lift for tooltip */
        }
        .class-block:hover .tooltip {
            opacity: 1;
            transform: translateY(0);
        }
        .grid-background-lines {
            /* Adds horizontal lines to represent time slots, starting from 9 AM */
            background-image: linear-gradient(to bottom, #e7e5e4 1px, transparent 1px);
            background-size: 100% 4rem; /* 4rem per hour */
            background-position-y: calc(-9 * 4rem); /* Adjust to start lines from 9 AM */
        }
        .current-day {
            background-color: #fffbeb !important; /* yellow-50, slightly lighter */
            border-left: 4px solid #fbbf24; /* yellow-400, slightly more vibrant */
            box-shadow: 0 2px 8px rgba(251, 191, 36, 0.2); /* Subtle shadow for current day */
        }
        .time-label {
            height: 4rem; /* Each time slot is 4rem tall */
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.5rem;
            font-size: 0.875rem; /* text-sm */
            color: #78716c; /* stone-500 */
            border-bottom: 1px solid #e7e5e4;
        }
        .time-axis-column {
            background-color: #f8f8f8;
            border-right: 1px solid #e7e5e4;
            position: sticky;
            left: 0;
            z-index: 10;
        }
        /* Custom scrollbar for aesthetic appeal */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #d6d3d1; /* stone-300 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a29e; /* stone-400 */
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        
        <header class="text-center mb-8 bg-white p-6 rounded-2xl shadow-xl">
            <h1 class="text-3xl sm:text-4xl font-bold text-stone-800 bg-clip-text text-transparent bg-gradient-to-r from-amber-600 to-yellow-500 pb-2">1st Year, 1st Semester Timetable</h1>
            <p class="text-stone-600 mt-2 text-lg">An interactive dashboard to explore your B.Sc. (Engg.) 2025 schedule.</p>
        </header>

        <div id="controls" class="flex flex-col sm:flex-row gap-4 justify-center mb-8 p-4 bg-white rounded-2xl shadow-lg">
            <div class="flex items-center gap-2">
                <label for="day-filter" class="font-medium text-stone-700">Filter by Day:</label>
                <select id="day-filter" class="bg-stone-50 border border-stone-300 text-stone-700 rounded-lg focus:ring-amber-500 focus:border-amber-500 block w-full sm:w-auto p-2.5 transition duration-200 ease-in-out hover:border-amber-400">
                    <option value="all">All Days</option>
                    <option value="Sunday">Sunday</option>
                    <option value="Monday">Monday</option>
                    <option value="Tuesday">Tuesday</option>
                    <option value="Wednesday">Wednesday</option>
                    <option value="Thursday">Thursday</option>
                </select>
            </div>
            <div class="flex items-center gap-2">
                <label for="type-filter" class="font-medium text-stone-700">Filter by Type:</label>
                <select id="type-filter" class="bg-stone-50 border border-stone-300 text-stone-700 rounded-lg focus:ring-amber-500 focus:border-amber-500 block w-full sm:w-auto p-2.5 transition duration-200 ease-in-out hover:border-amber-400">
                    <option value="all">All Types</option>
                    <option value="Lecture">Lecture</option>
                    <option value="Lab">Lab</option>
                </select>
            </div>
            <div class="flex items-center gap-2">
                <label for="group-filter" class="font-medium text-stone-700">Filter by Group:</label>
                <select id="group-filter" class="bg-stone-50 border border-stone-300 text-stone-700 rounded-lg focus:ring-amber-500 focus:border-amber-500 block w-full sm:w-auto p-2.5 transition duration-200 ease-in-out hover:border-amber-400">
                    <option value="all">All Groups</option>
                    <option value="A">Group A</option>
                    <option value="B">Group B</option>
                    <option value="N/A">N/A (No Group)</option>
                </select>
            </div>
        </div>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 bg-white p-4 sm:p-6 rounded-2xl shadow-xl overflow-x-auto">
                <div class="relative min-w-[600px] sm:min-w-full">
                    <div id="timetable-grid" class="grid gap-px bg-stone-200 border border-stone-200 rounded-lg overflow-hidden">
                        <!-- Time axis and day headers will be generated by JS -->
                    </div>
                    <div id="no-classes-message" class="hidden text-center text-stone-500 p-8 text-lg">
                        No classes found matching your filters. Try adjusting your selections!
                    </div>
                </div>
            </div>

            <aside class="flex flex-col gap-8">
                <div class="bg-white p-4 sm:p-6 rounded-2xl shadow-xl">
                    <h2 class="text-xl font-bold text-stone-800 mb-4">Course & Faculty Details</h2>
                    <ul id="details-list" class="space-y-3 text-sm">
                        <!-- Details will be generated by JS -->
                    </ul>
                </div>
            </aside>
        </main>

    </div>

    <script>
        // Sample schedule data for the timetable
        const scheduleData = [
            { day: 'Sunday', start: '9:00', end: '12:00', courseCode: 'EEE 1102', courseName: 'Electrical Circuit Analysis Lab', group: 'A', faculty: 'IA, SMSI', type: 'Lab', color: 'bg-sky-100', borderColor: 'border-sky-500' },
            { day: 'Sunday', start: '13:30', end: '14:50', courseCode: 'GED 1101', courseName: 'English for Technical Communication', group: 'N/A', faculty: 'MR', type: 'Lecture', color: 'bg-amber-100', borderColor: 'border-amber-500' },
            { day: 'Sunday', start: '15:00', end: '16:20', courseCode: 'MAT 1103', courseName: 'Linear Algebra and Numerical Analysis', group: 'N/A', faculty: 'KCS', type: 'Lecture', color: 'bg-teal-100', borderColor: 'border-teal-500' },
            { day: 'Monday', start: '10:00', end: '13:00', courseCode: 'EEE 1104', courseName: 'Computer Aided Engineering Drawing', group: 'B', faculty: 'MAH, MH', type: 'Lab', color: 'bg-indigo-100', borderColor: 'border-indigo-500' },
            { day: 'Monday', start: '13:30', end: '14:50', courseCode: 'MAT 1101', courseName: 'Differential and Integral Calculus', group: 'N/A', faculty: 'MJU', type: 'Lecture', color: 'bg-teal-100', borderColor: 'border-teal-500' },
            { day: 'Monday', start: '15:00', end: '16:20', courseCode: 'PHY 1101', courseName: 'Electricity and Magnetism', group: 'N/A', faculty: 'MJR', type: 'Lecture', color: 'bg-rose-100', borderColor: 'border-rose-500' },
            { day: 'Tuesday', start: '13:30', end: '14:50', courseCode: 'GED 1101', courseName: 'English for Technical Communication', group: 'N/A', faculty: 'MR', type: 'Lecture', color: 'bg-amber-100', borderColor: 'border-amber-500' },
            { day: 'Tuesday', start: '15:00', end: '16:20', courseCode: 'EEE 1101', courseName: 'Electrical Circuit Analysis', group: 'N/A', faculty: 'MHR', type: 'Lecture', color: 'bg-sky-100', borderColor: 'border-sky-500' },
            { day: 'Wednesday', start: '9:00', end: '12:00', courseCode: 'EEE 1102', courseName: 'Electrical Circuit Analysis Lab', group: 'B', faculty: 'IA, SMSI', type: 'Lab', color: 'bg-sky-100', borderColor: 'border-sky-500' },
            { day: 'Wednesday', start: '10:00', end: '13:00', courseCode: 'EEE 1104', courseName: 'Computer Aided Engineering Drawing', group: 'A', faculty: 'MAH, MH', type: 'Lab', color: 'bg-indigo-100', borderColor: 'border-indigo-500' },
            { day: 'Wednesday', start: '13:30', end: '14:50', courseCode: 'MAT 1103', courseName: 'Linear Algebra and Numerical Analysis', group: 'N/A', faculty: 'KCS', type: 'Lecture', color: 'bg-teal-100', borderColor: 'border-teal-500' },
            { day: 'Wednesday', start: '15:00', end: '16:20', courseCode: 'PHY 1101', courseName: 'Electricity and Magnetism', group: 'N/A', faculty: 'MJR', type: 'Lecture', color: 'bg-rose-100', borderColor: 'border-rose-500' },
            { day: 'Thursday', start: '13:30', end: '14:50', courseCode: 'MAT 1101', courseName: 'Differential and Integral Calculus', group: 'N/A', faculty: 'MJU', type: 'Lecture', color: 'bg-teal-100', borderColor: 'border-teal-500' },
            { day: 'Thursday', start: '15:00', end: '16:20', courseCode: 'EEE 1101', courseName: 'Electrical Circuit Analysis', group: 'N/A', faculty: 'MHR', type: 'Lecture', color: 'bg-sky-100', borderColor: 'border-sky-500' },
        ];

        // Faculty abbreviations and their full names
        const facultyDetails = {
            'MHR': 'Md. Habibur Rahman', 'MJR': 'M. Junaebur Rashid', 'SMSI': 'Sazzad M. S. Imran', 'IA': 'Imtiaz Ahmed',
            'MAH': 'Md. Ahsan Habib', 'MH': 'Mainul Hossain', 'KCS': 'Kajal Chandra Saha', 'MJU': 'Md. Jasim Uddin', 'MR': 'Mizanur Rahman'
        };
        
        // Course details including room numbers
        const courseDetails = {
            'EEE 1101': { name: 'Electrical Circuit Analysis', room: '208' },
            'EEE 1102': { name: 'Electrical Circuit Analysis Laboratory', room: '301' },
            'MAT 1103': { name: 'Linear Algebra and Numerical Analysis', room: '208' },
            'GED 1101': { name: 'English for Technical Communication', room: '208' },
            'PHY 1101': { name: 'Electricity and Magnetism', room: '208' },
            'MAT 1101': { name: 'Differential and Integral Calculus', room: '208' },
            'EEE 1104': { name: 'Computer Aided Engineering Drawing', room: '206' }
        };

        // Days of the week for the timetable
        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday'];
        
        // Event listener for when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            const dayFilter = document.getElementById('day-filter');
            const typeFilter = document.getElementById('type-filter');
            const groupFilter = document.getElementById('group-filter');

            // Initial rendering of the timetable and details list
            renderTimetable();
            renderDetailsList();
            
            // Add event listeners for filter changes to re-render the timetable
            dayFilter.addEventListener('change', renderTimetable);
            typeFilter.addEventListener('change', renderTimetable);
            groupFilter.addEventListener('change', renderTimetable);
            
            // Highlight the current day on load
            highlightCurrentDay();
        });

        /**
         * Converts a time string (e.g., "9:00") to minutes from midnight.
         * @param {string} time - The time string in "HH:MM" format.
         * @returns {number} The time in minutes from midnight.
         */
        function timeToMinutes(time) {
            const [hours, minutes] = time.split(':').map(Number);
            return hours * 60 + minutes;
        }

        /**
         * Formats a 24-hour time string to 12-hour format with AM/PM.
         * @param {string} time24 - The time string in "HH:MM" (24-hour) format.
         * @returns {string} The formatted time string (e.g., "01:30 PM").
         */
        function formatTimeTo12Hr(time24) {
            const [hours, minutes] = time24.split(':').map(Number);
            const period = hours >= 12 ? 'PM' : 'AM';
            const hours12 = hours % 12 || 12; // Convert 0 to 12 for 12 AM
            return `${hours12.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')} ${period}`;
        }

        /**
         * Renders the academic timetable based on selected filters.
         * Implements a basic column-packing algorithm for overlapping events.
         */
        function renderTimetable() {
            const grid = document.getElementById('timetable-grid');
            const noClassesMessage = document.getElementById('no-classes-message');
            grid.innerHTML = ''; // Clear previous timetable content
            noClassesMessage.classList.add('hidden'); // Hide message by default
            
            // Get current filter values
            const dayFilterValue = document.getElementById('day-filter').value;
            const typeFilterValue = document.getElementById('type-filter').value;
            const groupFilterValue = document.getElementById('group-filter').value;

            // Determine which days to display based on the day filter
            const filteredDays = days.filter(day => dayFilterValue === 'all' || day === dayFilterValue);
            
            // Adjust grid columns based on screen width and filtered days
            // Always add 1 for the time axis column
            if (window.innerWidth >= 640) {
                grid.style.gridTemplateColumns = `80px repeat(${filteredDays.length}, minmax(0, 1fr))`;
            } else {
                // On small screens, always show one column for days, plus the time axis
                grid.style.gridTemplateColumns = '80px minmax(0, 1fr)';
            }

            // Create time axis column header (empty corner)
            const emptyHeader = document.createElement('div');
            emptyHeader.className = 'text-center font-bold p-3 bg-white text-stone-700 sticky top-0 z-10 border-b border-stone-200 time-axis-column';
            grid.appendChild(emptyHeader);

            // Create day headers
            filteredDays.forEach(day => {
                const header = document.createElement('div');
                header.className = 'text-center font-bold p-3 bg-white text-stone-700 sticky top-0 z-10 border-b border-stone-200';
                header.textContent = day;
                grid.appendChild(header);
            });

            // Create time labels and day columns
            const startHour = 9; // Timetable starts visually at 9 AM
            const endHour = 21; // Timetable ends visually at 9 PM (21:00)
            const totalHours = endHour - startHour;

            // Create the time axis column content
            const timeAxisColumnDiv = document.createElement('div');
            timeAxisColumnDiv.className = 'time-axis-column relative grid-background-lines';
            timeAxisColumnDiv.style.height = `${totalHours * 4}rem`; // Total height for all time slots
            grid.appendChild(timeAxisColumnDiv);

            for (let h = startHour; h < endHour; h++) {
                const timeLabel = document.createElement('div');
                const hour12 = h % 12 || 12;
                const period = h >= 12 ? 'PM' : 'AM';
                timeLabel.textContent = `${hour12}${period}`;
                timeLabel.className = 'time-label';
                timeAxisColumnDiv.appendChild(timeLabel);
            }

            // Create day columns (content area)
            filteredDays.forEach(day => {
                const dayColumn = document.createElement('div');
                dayColumn.className = `day-column bg-stone-50 relative grid-background-lines`;
                dayColumn.dataset.day = day;
                dayColumn.style.height = `${totalHours * 4}rem`; // Match height of time axis
                grid.appendChild(dayColumn);
            });

            // Set to keep track of unique items already displayed to avoid duplication
            const displayedItems = new Set();
            
            // Filter the schedule data based on user selections
            const filteredSchedule = scheduleData.filter(item => {
                const isDayMatch = (dayFilterValue === 'all' || item.day === dayFilterValue);
                const isTypeMatch = (typeFilterValue === 'all' || item.type === typeFilterValue);
                
                let isGroupMatch = false;
                if (groupFilterValue === 'all') {
                    // If 'All Groups' is selected, show group-specific classes (A or B) and N/A classes.
                    isGroupMatch = (item.group === 'A' || item.group === 'B' || item.group === 'N/A');
                } else if (groupFilterValue === 'N/A') {
                    // If 'N/A' is selected, only show classes with group 'N/A'.
                    isGroupMatch = (item.group === 'N/A');
                } else {
                    // If 'Group A' or 'Group B' is selected, show classes for that specific group AND classes with group 'N/A'.
                    isGroupMatch = (item.group === groupFilterValue || item.group === 'N/A');
                }

                if (isDayMatch && isTypeMatch && isGroupMatch) {
                    // Create a unique identifier. For lectures (group 'N/A'), treat them as the same regardless of
                    // which group filter (A or B) might make them eligible. This prevents duplication when 'All Groups' is selected.
                    const uniqueId = `${item.day}-${item.start}-${item.end}-${item.courseCode}-${item.type === 'Lecture' ? 'Lecture_Common' : item.group}`;
                    if (!displayedItems.has(uniqueId)) {
                        displayedItems.add(uniqueId);
                        return true;
                    }
                }
                return false;
            });

            // If no classes found, display message and hide grid
            if (filteredSchedule.length === 0) {
                grid.innerHTML = ''; // Clear grid content
                noClassesMessage.classList.remove('hidden');
                return;
            }

            // Group filtered events by day to process overlaps within each day
            const eventsByDay = {};
            filteredDays.forEach(day => {
                eventsByDay[day] = [];
            });

            filteredSchedule.forEach(item => {
                eventsByDay[item.day].push(item);
            });

            // Process and render events for each day, handling overlaps
            Object.keys(eventsByDay).forEach(day => {
                const dayEvents = eventsByDay[day];
                const timeWrapper = grid.querySelector(`.day-column[data-day="${day}"]`);
                if (!timeWrapper) return; // Skip if day column not found (e.g., filtered out)

                // Sort events by start time for consistent overlap calculation
                dayEvents.sort((a, b) => timeToMinutes(a.start) - timeToMinutes(b.start));

                // This is a simplified column packing algorithm for visual layout.
                // It finds the minimum number of columns needed for overlapping events
                // and assigns each event to a column.
                const columns = []; // Each column stores the end time of its last event
                const eventPositions = new Map(); // Map event object to its assigned column index

                dayEvents.forEach(event => {
                    const startMinutes = timeToMinutes(event.start);
                    const endMinutes = timeToMinutes(event.end);
                    
                    let placedInColumn = false;
                    // Try to place the event in an existing column where it doesn't overlap
                    for (let i = 0; i < columns.length; i++) {
                        if (startMinutes >= columns[i]) { // If current event starts after or at the same time as the last event in this column ends
                            columns[i] = endMinutes; // Update the column's end time
                            eventPositions.set(event, i); // Assign event to this column
                            placedInColumn = true;
                            break;
                        }
                    }
                    // If no suitable column found, create a new one
                    if (!placedInColumn) {
                        columns.push(endMinutes);
                        eventPositions.set(event, columns.length - 1); // Assign event to the new column
                    }
                });

                const maxColumns = columns.length > 0 ? columns.length : 1; // Ensure at least 1 column for width calculation

                // Now, create and position the actual class blocks
                dayEvents.forEach(item => {
                    const startMinutes = timeToMinutes(item.start);
                    const endMinutes = timeToMinutes(item.end);
                    
                    // Calculate top offset and height based on a 9:00 AM start and 4rem per hour scale
                    const topOffset = ((startMinutes - (startHour * 60)) / 60) * 4; // Adjusted to startHour
                    const height = ((endMinutes - startMinutes) / 60) * 4;

                    const block = document.createElement('div');
                    block.className = `class-block absolute p-2 rounded-lg border-l-4 shadow-md transition-all duration-300 ease-in-out transform hover:scale-[1.02] ${item.color} ${item.borderColor}`;
                    block.style.top = `${topOffset}rem`;
                    block.style.height = `${height}rem`;

                    // Get the assigned column index for this event
                    const columnIndex = eventPositions.get(item) || 0; // Default to 0 if not found (shouldn't happen)
                    const blockWidth = `calc(${100 / maxColumns}% - 4px)`; // Distribute width among columns, with a small gap
                    const blockLeft = `${(100 / maxColumns) * columnIndex}%`;

                    block.style.width = blockWidth;
                    block.style.left = blockLeft;

                    block.innerHTML = `
                        <p class="font-semibold text-xs leading-tight">${item.courseName}</p> <!-- Changed from courseCode to courseName -->
                        <p class="text-xs opacity-80">${formatTimeTo12Hr(item.start)} - ${formatTimeTo12Hr(item.end)}</p>
                        <div class="tooltip">
                            <strong class="block">${item.courseName} ${item.group && item.group !== 'N/A' ? `(Group ${item.group})` : ''}</strong>
                            Faculty: ${item.faculty}<br>
                            Room: ${courseDetails[item.courseCode]?.room || 'N/A'}
                        </div>
                    `;
                    
                    timeWrapper.appendChild(block);
                });
            });
            highlightCurrentDay(); // Re-highlight current day after rendering
        }
        
        /**
         * Highlights the current day column in the timetable.
         * Uses 'Asia/Dhaka' timezone for consistency with the timetable data.
         */
        function highlightCurrentDay() {
            // Get the current day of the week in 'Asia/Dhaka' timezone
            const today = new Date().toLocaleString('en-US', { weekday: 'long', timeZone: 'Asia/Dhaka' });
            const dayColumns = document.querySelectorAll('.day-column');
            dayColumns.forEach(col => {
                col.classList.remove('current-day'); // Remove highlight from all columns first
                if (col.dataset.day === today) {
                    col.classList.add('current-day'); // Add highlight to the current day
                }
            });
        }
        
        /**
         * Renders the list of course and faculty details in the sidebar.
         */
        function renderDetailsList() {
            const list = document.getElementById('details-list');
            list.innerHTML = ''; // Clear previous content
            
            // Create a set to store unique course codes to avoid duplicates in the list
            const uniqueCourseCodes = new Set();
            const uniqueCourses = [];
            scheduleData.forEach(item => {
                if (!uniqueCourseCodes.has(item.courseCode)) {
                    uniqueCourseCodes.add(item.courseCode);
                    uniqueCourses.push(item);
                }
            });

            // Sort unique courses by course code for consistent display
            uniqueCourses.sort((a, b) => a.courseCode.localeCompare(b.courseCode));

            // Add unique courses to the details list
            uniqueCourses.forEach(course => {
                const li = document.createElement('li');
                li.className = 'flex items-center gap-3';
                const colorDiv = document.createElement('div');
                colorDiv.className = `w-4 h-4 rounded-full ${course.color} shadow-sm`;
                li.appendChild(colorDiv);
                
                const textDiv = document.createElement('div');
                textDiv.innerHTML = `<span class="font-semibold text-stone-700">${course.courseCode}:</span> <span class="text-stone-600">${course.courseName}</span>`;
                li.appendChild(textDiv);
                
                list.appendChild(li);
            });
            
            // Add a separator
            const hr = document.createElement('hr');
            hr.className = 'my-4 border-stone-200';
            list.appendChild(hr);
            
            // Add faculty details to the list, sorted by abbreviation
            const sortedFaculty = Object.entries(facultyDetails).sort(([abbrA], [abbrB]) => abbrA.localeCompare(abbrB));
            sortedFaculty.forEach(([abbr, name]) => {
                const li = document.createElement('li');
                li.innerHTML = `<span class="font-semibold text-stone-700">${abbr}:</span> <span class="text-stone-600">${name}</span>`;
                list.appendChild(li);
            });
        }
    </script>
</body>
</html>
